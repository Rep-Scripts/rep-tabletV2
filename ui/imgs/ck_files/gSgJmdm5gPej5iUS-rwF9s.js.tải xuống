;/*FB_PKG_DELIM*/

__d("LSUpdateOrInsertReactionV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[];return b.seq([function(d){return b.db.table(226).fetch([[[a[0],a[1],a[2]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?b.db.table(12).fetch([[[a[1]]],"messageId"]).next().then(function(d,e){var c=d.done;d=d.value;return c?0:(e=d.item,b.seq([function(c){return b.fe(b.ftr(b.db.table(226).fetch([[[a[0],a[1],a[2]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.messageId===a[1]&&b.i64.eq(c.reactionFbid,a[2])&&b.i64.lt(c.authorityLevel,a[5])}),function(a){return a["delete"]()})},function(c){return b.db.table(226).add({messageId:a[1],threadKey:a[0],reactionFbid:a[2],messageTimestamp:e.timestampMs,authorityLevel:a[5],count:a[4],viewerIsReactor:a[6],viewerReactionTimestampMs:a[7],lastUpdatedTimestampMs:a[8]})}]))}):(e=d.item,c[2]=e.lastUpdatedTimestampMs,c[1]=e.authorityLevel,b.i64.eq(a[5],b.i64.cast([0,20]))||b.i64.eq(c[1],b.i64.cast([0,80]))&&b.i64.eq(a[5],b.i64.cast([0,80]))||b.i64.eq(c[1],b.i64.cast([0,20]))&&b.i64.eq(a[5],b.i64.cast([0,80]))&&b.i64.le(b.i64.add(c[2],b.i64.cast([0,2e3])),a[8])||b.i64.eq(c[1],b.i64.cast([0,20]))&&b.i64.eq(a[5],b.i64.cast([0,60]))||b.i64.eq(c[1],b.i64.cast([0,60]))&&b.i64.eq(a[5],b.i64.cast([0,80]))&&b.i64.le(c[2],a[8])?c[3]=!0:c[3]=!1,c[3]?b.db.table(226).put({messageId:a[1],threadKey:a[0],reactionFbid:a[2],messageTimestamp:e.messageTimestamp,reactionLiteral:a[3],count:a[4],authorityLevel:a[5],viewerIsReactor:a[6],viewerReactionTimestampMs:b.i64.cast([0,0]),lastUpdatedTimestampMs:a[8]}):b.resolve())})},function(a){return b.resolve(d)}])}b=a;f["default"]=b}),66);
__d("LSUpsertReaction",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(8).put({threadKey:a[0],messageId:a[2],actorId:a[3],timestampMs:a[1],reaction:a[4],authorityLevel:a[5]})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("MAWMiActCreateThreadInActWithMiData",["I64","MAWBridgeSendAndReceive","MAWJids","MAWJobDefinitions","MAWTTRC","MAWTrackPendingOccamadilloThreads","MAWUIJob","WAJobOrchestratorTypes","WALoggerDeferred","asyncToGeneratorRuntime","getErrorSafe","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Querying WA server for group: ",""]);h=function(){return a};return a}function a(a,b,c,d,e){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){try{b=d("I64").to_string(b);var i=g?d("MAWJids").toGroupJid(b):d("MAWJids").toUserJid(b);d("MAWTrackPendingOccamadilloThreads").addPendingThread(b);a=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","createThreadThroughMI",{authoritativeThreadKey:d("I64").to_string(a),chatJid:i,lastActivityTimestampMs:d("I64").to_float(e),lastReadWatermarkTimestampMs:d("I64").to_float(f)}));g&&(a.isCreated&&(c("promiseDone")(d("WALoggerDeferred").DEV(h(),b)),yield d("MAWUIJob").UIJobStarters.waitUntilCompleted(d("MAWJobDefinitions").createStartJobInfo("queryGroups",{group:d("MAWJids").toGroupJid(b),scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH},type:"single"}))));c("promiseDone")(d("MAWTrackPendingOccamadilloThreads").removePendingThread(b));return a}catch(a){d("MAWTTRC").addStringAnnotation("thread_mapping_error",(e=(i=c("getErrorSafe")(a))==null?void 0:i.message)!=null?e:"unknown");throw a}});return i.apply(this,arguments)}g.miActCreateThreadInActWithMiData=a}),98);
__d("MAWMiActLoadExistingThread",["FBLogger","I64","LSAuthorityLevel","LSFactory","LSIntEnum","LSMessagingThreadTypeUtil","LSVerifyE2EEMetadataThreadExistsV2","MAWMiActCreateThreadInActWithMiData","MAWMiActGetThreadLifecycleState","MAWMiActThreadLifecycleState","WALoggerDeferred","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MiActMapping] Running verify thread exists sproc for state "," threadKey: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MiActMapping] Retry ACT thread creation for threadKey: ",""]);i=function(){return a};return a}function j(a,b){return a.runInTransaction(function(a){return c("LSVerifyE2EEMetadataThreadExistsV2")(d("LSIntEnum").ofNumber(15),b,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),c("LSFactory")(a)).then(function(){})},"readwrite")}function k(a){return d("MAWMiActCreateThreadInActWithMiData").miActCreateThreadInActWithMiData(a.serverThreadKey,a.jidInt64,a.thread.lastActivityTimestampMs,a.thread.lastReadWatermarkTimestampMs,d("LSMessagingThreadTypeUtil").isGroup(a.thread.threadType)).then(function(){})}function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=(yield d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByThreadKey(a,b,"loadExistingThread"));switch(e.type){case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY:c("promiseDone")(d("WALoggerDeferred").LOG(i(),d("I64").to_string(b)));return k(e);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.THREAD_KEY_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY_BY_JID:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY_BY_CHAT_ID:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW:c("promiseDone")(d("WALoggerDeferred").LOG(h(),e.type,d("I64").to_string(b)));return j(a,b);default:e.type;throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[MiActMapping] Unreachable miActThreadState.type: %s",e.type)}});return l.apply(this,arguments)}g["default"]=a}),98);
__d("MWCMInboxHeaderCommunityGroupName.react",["fbt","CometPagelet.react","I64","LSSuspense","MWCMThreadTypes.react","PresenceStatusContext","Promise","cr:5141","gkx","react","useCommunityFolder"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react"),j=d("react").useContext;function k(a){return a}function a(a){var e,f=a.renderWrapper;a=a.thread;f=f!=null?f:k;var g=c("useCommunityFolder")(a),l=j(c("PresenceStatusContext"));e=(e=b("cr:5141")==null?void 0:b("cr:5141")(a.threadKey))!=null?e:d("I64").neg_one;if(g!=null){var m=a.cannotReplyReason==="broadcast_chat_read_only",n=d("MWCMThreadTypes.react").isBroadcastThread(a.threadType)&&!m?c("gkx")("5555")?h._("__JHASH__2Tijp2ORsFi__JHASH__"):h._("__JHASH__QrGOls5Na3V__JHASH__"):d("MWCMThreadTypes.react").isPrivateThread(a.threadType)?h._("__JHASH__AR0EXhdbXqJ__JHASH__"):null;f=f(d("I64").gt(e,d("I64").zero)&&l.getChatVisibility()?h._("__JHASH__zBhIvI5rTRs__JHASH__",[h._plural(d("I64").to_int32(e),"number")]):d("MWCMThreadTypes.react").isBroadcastThread(a.threadType)&&!m&&c("gkx")("5555")?i.jsxs(i.Fragment,{children:[n," ",n!=null?"\u2022":null," ",g.name]}):i.jsxs(i.Fragment,{children:[g.name," ",n!=null?"\u2022":null," ",n]}))}else f=c("LSSuspense").throwErrorOrPromise(b("Promise").resolve());return i.jsx(d("CometPagelet.react").Placeholder,{className:"x193iq5w",fallback:null,name:"MWCMInboxHeaderCommunityGroupName",children:f})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useMWV2EnsureThatChatTabExists",["Int64Hooks","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSMessagingThreadTypeUtil","LSVerifyContactRowExists","LSVerifyThreadRowExists","Promise","cr:6435","promiseDone","useReStore"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.threadKey,f=a.threadType,g=c("useReStore")();d("Int64Hooks").useEffectInt64(function(){var a=function(){if(d("LSMessagingThreadTypeUtil").isOneToOne(f))return g.runInTransaction(function(a){return c("LSVerifyContactRowExists")(e,d("LSIntEnum").ofNumber(c("LSContactIdType").FBID),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactType").USER),void 0,void 0,void 0,void 0,!1,!1,d("LSIntEnum").ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),void 0,!1,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").CLIENT_PARTIAL),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactGender").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactViewerRelationship").UNKNOWN),void 0,c("LSFactory")(a))},"readwrite");else return b("Promise").resolve()};c("promiseDone")(a().then(function(){return b("cr:6435")!=null&&d("LSMessagingThreadTypeUtil").isSecure(f)?b("cr:6435")(g,e):g.runInTransaction(function(a){return c("LSVerifyThreadRowExists")(e,f,d("LSIntEnum").ofNumber(1),c("LSFactory")(a))},"readwrite")}))},[g,e,f])}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("MWV2ChatOverflowHead.bs",["fbt","ix","CometContextualLayer.react","CometListCellGlimmer.react","CometMenuItemBase.react","CometTextWithEntities.react","I64","LSMediaUrl.bs","LSThreadAttributionStore.bs","LSThreadTitle.react","MDSGlimmer.react","MWChatHeadPicture.react","MWChatInteraction.bs","MWChatStateActions","MWChatStateV2.bs","MWChatStateV2Types","MWChatTextTransform","MWPActor.react","MWV2ChatHeadButton.react","MWXIcon.react","MWXMenu.react","MWXText.react","ReQL","ReQLSuspense","fbicon","react","recoverableViolation","stylex","useMWChatOpenTabTraceProvider","useMWFacepileGetContactsToShow","useMWV2EnsureThatChatTabExists","useReStore"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react");b=d("react");var k=b.useRef,l=b.useState;function m(a){var b,e=d("MWPActor.react").useActor(),g=c("useReStore")();return(b=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(g.table("threads")).getKeyRange(a).map(function(b){return d("ReQLSuspense").toArray(d("ReQL").fromTableDescending(g.table("messages")).getKeyRange(a).take(20).bounds({gt:d("ReQL").key(b.lastReadWatermarkTimestampMs)}).filter(function(a){return!d("I64").equal(a.senderId,e)}),f.id+":67").length})},[g,e,a],f.id+":61"))!=null?b:0}function n(a){a=a.thread;var b=m(a.threadKey);return j.jsxs(j.Fragment,{children:[j.jsx(c("LSThreadTitle.react"),{thread:a}),j.jsx(c("CometTextWithEntities.react"),{text:h._("__JHASH__-HzxiMQUhNs__JHASH__",[h._param("unread message count",String(b))]),transforms:d("MWChatTextTransform").epdTextTransforms})]})}var o={auxVisible:{visibility:"xnpuxes",$$css:!0},auxWrapper:{display:"x78zum5",visibility:"xlshs6z",$$css:!0}};function p(a){var b=a.closeTab,e=a.isItemHovered,f=a.setItemIsHovered;return j.jsx("div",{className:c("stylex")(o.auxWrapper,e?o.auxVisible:!1),children:j.jsx(c("MWXIcon.react"),{"aria-label":h._("__JHASH__LLeka0bmVM0__JHASH__"),color:"secondary",icon:d("fbicon")._(i("478231"),12),onHoverIn:function(){return f(!0)},onHoverOut:function(){return f(!1)},onPress:b})})}p.displayName=p.name+" [from "+f.id+"]";function q(a){var b=a.descriptor,e=a.setParentHoverState,g=a.tab,h=c("useReStore")(),i=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(h.table("threads")).getKeyRange(b.threadKey)},[h,b.threadKey],f.id+":169"),k=d("MWChatStateV2.bs").useDispatch(),m=c("useMWChatOpenTabTraceProvider")();c("useMWV2EnsureThatChatTabExists")({threadKey:b.threadKey,threadType:b.threadType});a=l(!1);var o=a[0],q=a[1];return i!=null?j.jsx(c("CometMenuItemBase.react"),{aux:j.jsx(p,{closeTab:function(){return k(d("MWChatStateActions").closeTab(Date.now(),g.tabId))},isItemHovered:o,setItemIsHovered:q,tab:g}),onClick:function(){e(!1);d("LSThreadAttributionStore.bs").setSource(d("I64").to_string(i.threadKey),"chatheadsOverflow");m(function(a){d("MWChatInteraction.bs").set(d("I64").to_string(i.threadKey),a)},d("I64").to_int32(i.threadType),"chatheadsOverflow",d("I64").to_string(i.threadKey));return k(d("MWChatStateActions").maximizeTab(Date.now(),g.tabId))},onHoverIn:function(){return q(!0)},onHoverOut:function(){return q(!1)},primaryText:j.jsx(n,{thread:i})}):j.jsx("div",{className:"xc9qbxq x5w4yej",children:j.jsx(c("CometListCellGlimmer.react"),{imageStyle:"none"})})}q.displayName=q.name+" [from "+f.id+"]";function r(a){var b=a.excessHeads,e=a.setParentHoverState;return j.jsx(c("MWXMenu.react"),{size:"full",truncate:!0,withArrow:!0,children:b.map(function(a){var b=a.tabType;return b.type!==d("MWChatStateV2Types").MWChatStateTabType.ComposeTab?j.jsx(q,{descriptor:b.threadKeyDescriptor,setParentHoverState:e,tab:a},String(a.tabId)):c("recoverableViolation")("Compose tab shouldn't be part of excess tabs","messenger_web_product")})})}r.displayName=r.name+" [from "+f.id+"]";function s(a){var b=a.count;a=a.thread;a=c("useMWFacepileGetContactsToShow")(a).map(d("LSMediaUrl.bs").Contact.profilePictureUrl);return j.jsx(c("MWChatHeadPicture.react"),{images:a,noDropShadow:!0,noFacepile:!0,children:j.jsx("div",{className:"x6s0dn4 x18l40ae x14yjl9h xudhj91 x18nykt9 xww2gxu x78zum5 xsdox4t xl56j7k x10l6tqk x13vifvy x1useyqa",children:j.jsx(c("MWXText.react"),{color:"white",type:"bodyLink3",children:h._("__JHASH__RM0bWy2OLZa__JHASH__",[h._param("chat count",String(b))])})})})}s.displayName=s.name+" [from "+f.id+"]";var t={glimmer:{borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",height:"x5yr21d",width:"xh8yej3",$$css:!0}};function u(a){var b=a.count,e=a.tab;c("useMWV2EnsureThatChatTabExists")({threadKey:e.threadKey,threadType:e.threadType});var g=c("useReStore")();a=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(g.table("threads")).getKeyRange(e.threadKey)},[g,e.threadKey],f.id+":331");return a!=null?j.jsx(s,{count:b,thread:a}):j.jsx(c("MDSGlimmer.react"),{index:1,xstyle:t.glimmer})}u.displayName=u.name+" [from "+f.id+"]";function a(a){var b=a.excessHeads,e=a.onHoverChange;a=a.style;var f=l(!1),g=f[0],i=f[1];f=b.length;var m=k(null);if(f<=0)return null;var n=b[0].tabType,o;n.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab?(c("recoverableViolation")("Compose tab shouldn't be part of excess tabs","messenger_web_product"),o=null):o=j.jsx(u,{count:f,tab:n.threadKeyDescriptor});return j.jsx(d("MWV2ChatHeadButton.react").MWV2ChatHeadButtonContainer,{style:a,children:j.jsx(d("MWV2ChatHeadButton.react").MWV2ChatHeadButton,{ariaLabel:h._("__JHASH__cpB5BWXmx9z__JHASH__",[h._param("chat count",String(f))]),ref:m,children:j.jsxs("div",{onMouseEnter:function(){i(!0),e(!0)},onMouseLeave:function(){i(!1),e(!1)},children:[o,g&&j.jsx(c("CometContextualLayer.react"),{align:"middle",contextRef:m,position:"end",children:j.jsx(r,{excessHeads:b,setParentHoverState:i})})]})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("GroupsCometRulesDialogQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9667731753300014"}),null);